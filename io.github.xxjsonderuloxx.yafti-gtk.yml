id: io.github.xxjsonderuloxx.yafti-gtk
runtime: org.gnome.Platform
runtime-version: '48'
sdk: org.gnome.Sdk
command: yafti_gtk.py

finish-args:
  - --socket=wayland
  - --socket=fallback-x11
  - --share=ipc
  - --device=dri
  - --filesystem=home
  - --filesystem=host:ro
  - --talk-name=org.freedesktop.Flatpak
  - --talk-name=org.freedesktop.portal.Desktop

modules:
  - name: vte
    buildsystem: meson
    config-opts:
      - -Dvapi=false
      - -Dgir=true
      - -Ddocs=false
    sources:
      - type: archive
        url: https://download.gnome.org/sources/vte/0.78/vte-0.78.2.tar.xz
        sha256: 35d7bcde07356846b4a12881c8e016705b70a9004a9082285eee5834ccc49890

  - name: python-pyyaml
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} "pyyaml" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/54/ed/79a089b6be93607fa5cdaedf301d7dfb23af5f25c398d5ead2525b063e17/pyyaml-6.0.2.tar.gz
        sha256: d584d9ec91ad65861cc08d42e834324ef890a082e591037abe114850ff7bbc3e

  - name: yafti-gtk
    buildsystem: simple
    build-commands:
      - install -D yafti_gtk.py ${FLATPAK_DEST}/bin/yafti_gtk.py
      - install -D io.github.xxjsonderuloxx.yafti-gtk.desktop ${FLATPAK_DEST}/share/applications/io.github.xxjsonderuloxx.yafti-gtk.desktop
      - install -D portal.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/io.github.xxjsonderuloxx.yafti-gtk.svg
      - install -D io.github.xxjsonderuloxx.yafti-gtk.metainfo.xml ${FLATPAK_DEST}/share/metainfo/io.github.xxjsonderuloxx.yafti-gtk.metainfo.xml
      - |
        mkdir -p ${FLATPAK_DEST}/lib/girepository-1.0 || true
        if [ -d ${FLATPAK_DEST}/lib64/girepository-1.0 ]; then
          cp -a ${FLATPAK_DEST}/lib64/girepository-1.0/* ${FLATPAK_DEST}/lib/girepository-1.0/ || true
        fi
    sources:
      - type: file
        path: yafti_gtk.py
      - type: file
        path: io.github.xxjsonderuloxx.yafti-gtk.desktop
      - type: file
        path: portal.svg
      - type: file
        path: io.github.xxjsonderuloxx.yafti-gtk.metainfo.xml